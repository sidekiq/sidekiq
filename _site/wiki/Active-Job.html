<!DOCTYPE html>
<html>
<head>
  <meta charset="utf8">
  <title>Sidekiq</title>
  <meta name="description" content="Simple, efficient background jobs for Ruby">
  <meta name="twitter:site" content="@sidekiq">
  <meta name="twitter:card" content="summary" />
  <meta property="og:site_name" content="Sidekiq">
  <meta property="og:type" content="company">
  <meta property="og:title" content="Simple, efficient background jobs for Ruby">
  <meta property="og:url" content="//sidekiq.org">
  <meta property="og:image" content="//sidekiq.org/assets/sidekiq.png">
  <meta property="og:description" content="Sidekiq is a simple, efficient framework for background jobs in Ruby">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Armata|Montserrat:400,700">
  <link rel="shortcut icon" type="image/ico" href="/favicon.ico">
  <link rel="me" href="https://ruby.social/@getajobmike">
  <script defer src="/js/jquery.min.js"></script>
  <script defer src="/js/bootstrap.min.js"></script>
  <script defer src="/js/scrollingcarousel.2.0.min.js"></script>
  <script defer src="/js/skq-global.js"></script>
</head>

<body>
  <style>
    h1, h2, h3 { border-bottom: 1px solid black; }
    img { max-width:100%; height: auto; }
  </style>
  <header>
  <nav role="navigation" class="navbar navbar-default navbar-fixed-top default">
    <div class="container-fluid skq-header">
      <div class="navbar-header">
        <a href="/" class="skq navbar-brand">Sidekiq</a><span
          class="default skq-tagline navbar-brand col-sm-5 hidden-md">Simple, efficient background jobs for Ruby.</span>
      </div>
      <div id="navbar-top-collapse-1" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="/" class="skq-nav-link">Back</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>

  <main class="container">
    <h1>Active Job</h1>
    <p class="small">Last synchronized at 2025-12-15 15:43:00 -0800</p>
    <div class="row">
      <div class="col-md-9"><p>Active Job is the Rails standard interface for interacting with job runners. Active Job can be configured to work with Sidekiq.</p>

<h2 id="active-job-setup">Active Job Setup</h2>

<p>The Active Job adapter must be set to <code class="language-plaintext highlighter-rouge">:sidekiq</code> or else it will use the default value provided by Rails, which is <code class="language-plaintext highlighter-rouge">:async</code>. This can be done in <code class="language-plaintext highlighter-rouge">config/application.rb</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
  <span class="c1"># ...</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">active_job</span><span class="p">.</span><span class="nf">queue_adapter</span> <span class="o">=</span> <span class="ss">:sidekiq</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We can use the generator to create a new job.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails generate job Example
</code></pre></div></div>
<p>This above command will create <code class="language-plaintext highlighter-rouge">app/jobs/example_job.rb</code></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ExampleJob</span> <span class="o">&lt;</span> <span class="no">ActiveJob</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># Set the Queue as Default</span>
  <span class="n">queue_as</span> <span class="ss">:default</span>

  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="c1"># Perform Job</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="usage">Usage</h2>

<p>Jobs can be added to the job queue from anywhere. We can add a job to the queue by:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ExampleJob</span><span class="p">.</span><span class="nf">perform_later</span> <span class="n">args</span>
</code></pre></div></div>

<p>At this point, Sidekiq will run the job for us. If the job for some reason fails, Sidekiq will retry as normal.</p>

<p>Note: This can be confusing when comparing Sidekiq and ActiveJob documentation, as ActiveJob does not provide a retry mechanism on its own, but failed ActiveJob jobs will retry.</p>

<h2 id="queues">Queues</h2>

<p>Sidekiq requires you to define the queues to process when it starts. You do this by listing the queue names in <code class="language-plaintext highlighter-rouge">config/sidekiq.yml</code> or using the <code class="language-plaintext highlighter-rouge">-q</code> argument in order of priority: <code class="language-plaintext highlighter-rouge">bundle exec sidekiq -q critical -q high -q default -q low</code></p>

<p>You can define the queue for a mailer</p>

<h2 id="customizing-error-handling">Customizing error handling</h2>

<p>Active Job has subtle semantic differences in its job error handling. It has a <a href="https://edgeapi.rubyonrails.org/classes/ActiveJob/Exceptions/ClassMethods.html">class-level API for declaring retry behavior upon encountering specific exceptions</a>. Sidekiq prefers you to use standard Ruby idioms like <code class="language-plaintext highlighter-rouge">begin; rescue</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ExampleJob</span> <span class="o">&lt;</span> <span class="no">ActiveJob</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">retry_on</span> <span class="no">ErrorLoadingSite</span><span class="p">,</span> <span class="ss">wait: </span><span class="mi">5</span><span class="p">.</span><span class="nf">minutes</span><span class="p">,</span> <span class="ss">queue: :low_priority</span> 
  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="c1"># Perform Job</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The default Active Job retry scheme—when using <code class="language-plaintext highlighter-rouge">retry_on</code>—is 5 retries, 3 seconds apart.  Once this is done (after 15-30 seconds), Active Job will kick the job back to Sidekiq, where Sidekiq’s retries with exponential backoff will take over.</p>

<ul>
  <li>You can use <code class="language-plaintext highlighter-rouge">sidekiq_options</code> with your Active Jobs and configure the standard Sidekiq retry mechanism.</li>
  <li>Sidekiq supports <code class="language-plaintext highlighter-rouge">sidekiq_retries_exhausted</code> and <code class="language-plaintext highlighter-rouge">sidekiq_retry_in</code> blocks on an ActiveJob
job as of 7.1.3.</li>
</ul>

<h2 id="action-mailer">Action Mailer</h2>

<p>Action Mailer now comes with a method named #deliver_later which will send emails asynchronously (your emails send in a background job). As long as Active Job is setup to use Sidekiq we can use #deliver_later. Unlike Sidekiq, using Active Job will serialize any activerecord instance with Global ID. Later the instance will be deserialized.</p>

<p>Mailers are queued in the queue <em>mailers</em> before Rails 6.1. Remember to start sidekiq processing that queue:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle exec sidekiq -q default -q mailers
</code></pre></div></div>

<p>To send a basic message to the Job Queue we can use:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">UserMailer</span><span class="p">.</span><span class="nf">welcome_email</span><span class="p">(</span><span class="vi">@user</span><span class="p">).</span><span class="nf">deliver_later</span>
</code></pre></div></div>

<p>If you would like to bypass the job queue and perform the job synchronously you can use:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">UserMailer</span><span class="p">.</span><span class="nf">welcome_email</span><span class="p">(</span><span class="vi">@user</span><span class="p">).</span><span class="nf">deliver_now</span>
</code></pre></div></div>

<p>With Sidekiq we had the option to send emails with a set delay. We can do this through Active Job as well.</p>

<p>Syntax to send delayed message through Active Job:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">UserMailer</span><span class="p">.</span><span class="nf">welcome_email</span><span class="p">(</span><span class="vi">@user</span><span class="p">).</span><span class="nf">deliver_later</span><span class="p">(</span><span class="ss">wait: </span><span class="mi">1</span><span class="p">.</span><span class="nf">hour</span><span class="p">)</span>
<span class="no">UserMailer</span><span class="p">.</span><span class="nf">welcome_email</span><span class="p">(</span><span class="vi">@user</span><span class="p">).</span><span class="nf">deliver_later</span><span class="p">(</span><span class="ss">wait_until: </span><span class="mi">5</span><span class="p">.</span><span class="nf">days</span><span class="p">.</span><span class="nf">from_now</span><span class="p">)</span>
</code></pre></div></div>

<p><a href="https://apidock.com/rails/ActionMailer/MessageDelivery/deliver_later">deliver_later</a> allows you to customize a number of options for the email job.</p>

<h2 id="using-global-id">Using Global ID</h2>

<p>Rails’s Global ID feature allows passing ActiveRecord models as arguments to <code class="language-plaintext highlighter-rouge">#perform</code>, so that</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
  <span class="n">user</span><span class="p">.</span><span class="nf">send_welcome_email!</span>
<span class="k">end</span>
</code></pre></div></div>

<p>can be replaced with:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
  <span class="n">user</span><span class="p">.</span><span class="nf">send_welcome_email!</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Unfortunately, this means that if the <code class="language-plaintext highlighter-rouge">User</code> record is deleted after the job is enqueued but before the <code class="language-plaintext highlighter-rouge">perform</code> method is called, exception handling is different. With regular Sidekiq, you could handle this with</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">id: </span><span class="n">user_id</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">user</span>
    <span class="n">user</span><span class="p">.</span><span class="nf">send_welcome_email!</span>
  <span class="k">else</span>
    <span class="c1"># handle a deleted user record</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>With Active Job, the <code class="language-plaintext highlighter-rouge">perform(user)</code> will instead <code class="language-plaintext highlighter-rouge">raise</code> for a missing record exception as part of deserializing the <code class="language-plaintext highlighter-rouge">User</code> instance.</p>

<p>You can work around this with</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyJob</span> <span class="o">&lt;</span> <span class="no">ActiveJob</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">rescue_from</span> <span class="no">ActiveJob</span><span class="o">::</span><span class="no">DeserializationError</span> <span class="k">do</span> <span class="o">|</span><span class="n">exception</span><span class="o">|</span>
    <span class="c1"># handle a deleted user record</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="job-id">Job ID</h2>

<p>Active Job has its own Job ID which is not used by Sidekiq.  You can get Sidekiq’s JID by using <code class="language-plaintext highlighter-rouge">provider_job_id</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">job</span> <span class="o">=</span> <span class="no">SomeJob</span><span class="p">.</span><span class="nf">perform_later</span>
<span class="n">jid</span> <span class="o">=</span> <span class="n">job</span><span class="p">.</span><span class="nf">provider_job_id</span>
</code></pre></div></div>

<h2 id="performance">Performance</h2>

<p>See <a href="https://gist.github.com/mperham/42307b8b135cd546ed68550e9af8a631">https://gist.github.com/mperham/42307b8b135cd546ed68550e9af8a631</a> for a Rails 8.0 benchmark test between Sidekiq and Solid Queue. Active Job adds about 30% overhead versus Sidekiq’s native Sidekiq::Job API.</p>

<p>Sidekiq is roughly 15x faster to enqueue jobs and 15x faster to execute jobs than Solid Queue due to transactional overhead.</p>

<p>Time to execute 500,000 no-op jobs:</p>

<table>
  <thead>
    <tr>
      <th>System</th>
      <th>Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Sidekiq/native</td>
      <td>19.0</td>
    </tr>
    <tr>
      <td>Sidekiq/AJ</td>
      <td>25.6</td>
    </tr>
    <tr>
      <td>Solid Queue/AJ</td>
      <td>293</td>
    </tr>
  </tbody>
</table>

<h2 id="queue-prefixes">Queue Prefixes</h2>

<p>Active Job allows you to configure a queue prefix. Don’t use environment-specific prefixes. Each environment should use a separate Redis database altogether, otherwise all of your environments will share the same retry and scheduled sets and chaos will likely ensue.</p>

<h2 id="commercial-features">Commercial Features</h2>

<p>A few Sidekiq Pro and Sidekiq Enterprise features will break in unpredictable ways if you try to use Active Job with those features. For instance, creating Active Jobs within a Batch will work in the base case but fail if you use Active Job’s retry mechanism in those jobs.</p>
</div>
      <div class="col-md-3"><h4>Wiki Pages</h4>
<ul>


  <li class="wiki-link"><a href='/wiki/API.html'>API</a></li>

  <li class="wiki-link"><a href='/wiki/Active-Job.html'>Active Job</a></li>

  <li class="wiki-link"><a href='/wiki/Advanced-Options.html'>Advanced Options</a></li>

  <li class="wiki-link"><a href='/wiki/Batches.html'>Batches</a></li>

  <li class="wiki-link"><a href='/wiki/Best-Practices.html'>Best Practices</a></li>

  <li class="wiki-link"><a href='/wiki/Build-vs-Buy.html'>Build vs Buy</a></li>

  <li class="wiki-link"><a href='/wiki/Bulk-Queueing.html'>Bulk Queueing</a></li>

  <li class="wiki-link"><a href='/wiki/Comm-Installation.html'>Comm Installation</a></li>

  <li class="wiki-link"><a href='/wiki/Commercial-FAQ.html'>Commercial FAQ</a></li>

  <li class="wiki-link"><a href='/wiki/Commercial-Support.html'>Commercial Support</a></li>

  <li class="wiki-link"><a href='/wiki/Commercial-collaboration.html'>Commercial collaboration</a></li>

  <li class="wiki-link"><a href='/wiki/Complex-Job-Workflows-with-Batches.html'>Complex Job Workflows with Batches</a></li>

  <li class="wiki-link"><a href='/wiki/Delayed-extensions.html'>Delayed extensions</a></li>

  <li class="wiki-link"><a href='/wiki/Deployment.html'>Deployment</a></li>

  <li class="wiki-link"><a href='/wiki/Devise.html'>Devise</a></li>

  <li class="wiki-link"><a href='/wiki/Embedding.html'>Embedding</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Encryption.html'>Ent Encryption</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Historical-Metrics.html'>Ent Historical Metrics</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Leader-Election.html'>Ent Leader Election</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Multi-Process.html'>Ent Multi Process</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Periodic-Jobs.html'>Ent Periodic Jobs</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Rate-Limiting.html'>Ent Rate Limiting</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Rolling-Restarts.html'>Ent Rolling Restarts</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Unique-Jobs.html'>Ent Unique Jobs</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Web-UI.html'>Ent Web UI</a></li>

  <li class="wiki-link"><a href='/wiki/Error-Handling.html'>Error Handling</a></li>

  <li class="wiki-link"><a href='/wiki/FAQ.html'>FAQ</a></li>

  <li class="wiki-link"><a href='/wiki/Getting-Started.html'>Getting Started</a></li>

  <li class="wiki-link"><a href='/wiki/Heroku.html'>Heroku</a></li>

  <li class="wiki-link"><a href='/wiki/Home.html'>Home</a></li>

  <li class="wiki-link"><a href='/wiki/Iteration.html'>Iteration</a></li>

  <li class="wiki-link"><a href='/wiki/Job-Format.html'>Job Format</a></li>

  <li class="wiki-link"><a href='/wiki/Job-Lifecycle.html'>Job Lifecycle</a></li>

  <li class="wiki-link"><a href='/wiki/Kubernetes.html'>Kubernetes</a></li>

  <li class="wiki-link"><a href='/wiki/Logging.html'>Logging</a></li>

  <li class="wiki-link"><a href='/wiki/Memory.html'>Memory</a></li>

  <li class="wiki-link"><a href='/wiki/Metrics.html'>Metrics</a></li>

  <li class="wiki-link"><a href='/wiki/Middleware.html'>Middleware</a></li>

  <li class="wiki-link"><a href='/wiki/Miscellaneous-Features.html'>Miscellaneous Features</a></li>

  <li class="wiki-link"><a href='/wiki/Monitoring.html'>Monitoring</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-API.html'>Pro API</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-Expiring-Jobs.html'>Pro Expiring Jobs</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-Metrics.html'>Pro Metrics</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-Reliability-Client.html'>Pro Reliability Client</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-Reliability-Server.html'>Pro Reliability Server</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-Web-UI.html'>Pro Web UI</a></li>

  <li class="wiki-link"><a href='/wiki/Problems-and-Troubleshooting.html'>Problems and Troubleshooting</a></li>

  <li class="wiki-link"><a href='/wiki/Profiling.html'>Profiling</a></li>

  <li class="wiki-link"><a href='/wiki/Really-Complex-Workflows-with-Batches.html'>Really Complex Workflows with Batches</a></li>

  <li class="wiki-link"><a href='/wiki/Related-Projects.html'>Related Projects</a></li>

  <li class="wiki-link"><a href='/wiki/Reliability.html'>Reliability</a></li>

  <li class="wiki-link"><a href='/wiki/Scaling.html'>Scaling</a></li>

  <li class="wiki-link"><a href='/wiki/Scheduled-Jobs.html'>Scheduled Jobs</a></li>

  <li class="wiki-link"><a href='/wiki/Sharding.html'>Sharding</a></li>

  <li class="wiki-link"><a href='/wiki/Signals.html'>Signals</a></li>

  <li class="wiki-link"><a href='/wiki/Testimonials.html'>Testimonials</a></li>

  <li class="wiki-link"><a href='/wiki/Testing.html'>Testing</a></li>

  <li class="wiki-link"><a href='/wiki/The-Basics.html'>The Basics</a></li>

  <li class="wiki-link"><a href='/wiki/Using-Dragonfly.html'>Using Dragonfly</a></li>

  <li class="wiki-link"><a href='/wiki/Using-Redis.html'>Using Redis</a></li>

</ul></div>
    </div>
  </main>
</body>
</html>

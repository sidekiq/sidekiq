<!DOCTYPE html>
<html>
<head>
  <meta charset="utf8">
  <title>Sidekiq</title>
  <meta name="description" content="Simple, efficient background jobs for Ruby">
  <meta name="twitter:site" content="@sidekiq">
  <meta name="twitter:card" content="summary" />
  <meta property="og:site_name" content="Sidekiq">
  <meta property="og:type" content="company">
  <meta property="og:title" content="Simple, efficient background jobs for Ruby">
  <meta property="og:url" content="//sidekiq.org">
  <meta property="og:image" content="//sidekiq.org/assets/sidekiq.png">
  <meta property="og:description" content="Sidekiq is a simple, efficient framework for background jobs in Ruby">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Armata|Montserrat:400,700">
  <link rel="shortcut icon" type="image/ico" href="/favicon.ico">
  <link rel="me" href="https://ruby.social/@getajobmike">
  <script defer src="/js/jquery.min.js"></script>
  <script defer src="/js/bootstrap.min.js"></script>
  <script defer src="/js/scrollingcarousel.2.0.min.js"></script>
  <script defer src="/js/skq-global.js"></script>
</head>

<body>
  <style>
    h1, h2, h3 { border-bottom: 1px solid black; }
    img { max-width:100%; height: auto; }
  </style>
  <header>
  <nav role="navigation" class="navbar navbar-default navbar-fixed-top default">
    <div class="container-fluid skq-header">
      <div class="navbar-header">
        <a href="/" class="skq navbar-brand">Sidekiq</a><span
          class="default skq-tagline navbar-brand col-sm-5 hidden-md">Simple, efficient background jobs for Ruby.</span>
      </div>
      <div id="navbar-top-collapse-1" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="/" class="skq-nav-link">Back</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>

  <main class="container">
    <h1>Deployment</h1>
    <p class="small">Last synchronized at 2025-12-15 15:43:00 -0800</p>
    <div class="row">
      <div class="col-md-9"><h2 id="overview">Overview</h2>

<p>To safely shut down Sidekiq, you need to send it the TSTP signal as <strong>early</strong> as possible in your deploy process and the TERM signal as <strong>late</strong> as possible.  TSTP tells Sidekiq to stop pulling new work and finish all current work.  TERM tells Sidekiq to exit within N seconds, where N is set by the <code class="language-plaintext highlighter-rouge">-t</code> timeout option and defaults to 25.  Using TSTP+TERM in your deploy process gives your jobs the maximum amount of time to finish before exiting.</p>

<p>If any jobs are still running when the timeout is up, Sidekiq <strong>will</strong> push those jobs back to Redis so they can be rerun later.</p>

<p>Your deploy scripts <strong>must</strong> give Sidekiq N+5 seconds to shutdown cleanly after the TERM signal. For example, if you send TERM and then send KILL 10 seconds later, you can lose jobs (if using Sidekiq) or see duplicate job execution (if using Sidekiq Pro’s super_fetch).</p>

<p><a href="https://www.youtube.com/watch?v=50nm6pY2gwg&amp;list=PLjeHh2LSCFrWGT5uVjUuFKAcrcj5kSai1"><img src="http://img.youtube.com/vi/50nm6pY2gwg/0.jpg" alt="Deployment" /></a></p>

<h2 id="network-architecture">Network Architecture</h2>

<p>I recommend running 1 or more Sidekiq processes per app server in your production cluster. At a previous employer, I ran two Sidekiq processes on three app servers, for six total processes.  With a concurrency of 10, this gives you 60 worker threads.  All six processes talked to the same Redis server and we used <code class="language-plaintext highlighter-rouge">high</code>, <code class="language-plaintext highlighter-rouge">default</code> and <code class="language-plaintext highlighter-rouge">low</code> queues to keep queue management and job priority as simple as possible.</p>

<p>Running separate machines for Sidekiq or using many different queues adds complexity where it was not needed for us.</p>

<h2 id="heroku">Heroku</h2>

<p>[[Heroku]] has its own page now.</p>

<h2 id="running-your-own-process">Running your own Process</h2>

<p>If you want to run Sidekiq on your own server, use systemd to start Sidekiq as a system service.  This will ensure the process is restarted if Sidekiq crashes.</p>

<p>Here’s an example <a href="https://github.com/sidekiq/sidekiq/tree/main/examples/systemd">systemd unit file</a>. The systemd documentation has sections on <a href="http://0pointer.de/public/systemd-man/systemd.service.html">the .service file</a> and <a href="http://0pointer.de/public/systemd-man/systemd.exec.html">executing processes</a>. <strong>Every developer who uses Linux should read these pages many times</strong>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl stop sidekiq
systemctl start sidekiq
systemctl restart sidekiq
systemctl kill -s TSTP sidekiq # quiet
</code></pre></div></div>

<p>Sidekiq Enterprise’s <a href="/wiki/Ent-Multi-Process.html"><code class="language-plaintext highlighter-rouge">sidekiqswarm</code></a> binary makes it trivial to start N Sidekiq processes with a single systemd service.  Take a look at <a href="https://github.com/ddollar/foreman">Foreman</a> for a useful tool to automate your application processes in development and production.</p>

<h2 id="capistrano">Capistrano</h2>

<p>Use the <code class="language-plaintext highlighter-rouge">capistrano-sidekiq</code> gem (<a href="https://github.com/seuros/capistrano-sidekiq">github</a>). Integrated support has been removed. Warning: Capistrano uses daemonization by default so if the Sidekiq process crashes, it will not restart automatically.</p>

<h2 id="events">Events</h2>

<p>Sidekiq fires process lifecycle events when starting up and shutting down:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Sidekiq</span><span class="p">.</span><span class="nf">configure_server</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># runs after your app has finished initializing but before any jobs are dispatched.</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:startup</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">make_some_singleton</span>
  <span class="k">end</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:quiet</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"Got TSTP, stopping further job processing..."</span>
  <span class="k">end</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:shutdown</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"Got TERM, shutting down process..."</span>
    <span class="n">stop_the_world</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This can be useful if you want to start/stop your own threads/actors.</p>

<p>Long running jobs (jobs running longer than the default 25 second timeout) can lead to job loss or duplicate execution.
We strongly urge these jobs to use the <code class="language-plaintext highlighter-rouge">Sidekiq::Job#interrupted?</code> method or the [[Iteration]] pattern (both available in 7.3+) to ensure they work well with Sidekiq.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># some_job.rb</span>
<span class="k">def</span> <span class="nf">perform</span>
  <span class="c1"># This job might process 1000s of items and take an hour.</span>
  <span class="c1"># Have each iteration check for shutdown. big_list_of_items</span>
  <span class="c1"># should only return unprocessed items so the loop will continue</span>
  <span class="c1"># where it left off.</span>
  <span class="n">big_list_of_items</span><span class="p">.</span><span class="nf">find_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
    <span class="n">process</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="c1"># Sidekiq will restart the job immediately on process restart</span>
    <span class="k">raise</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Shutdown</span> <span class="k">if</span> <span class="n">interrupted?</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Previous: <a href="/wiki/Deployment.html">Deployment</a> Next: <a href="/wiki/Monitoring.html">Monitoring</a></p>
</div>
      <div class="col-md-3"><h4>Wiki Pages</h4>
<ul>


  <li class="wiki-link"><a href='/wiki/API.html'>API</a></li>

  <li class="wiki-link"><a href='/wiki/Active-Job.html'>Active Job</a></li>

  <li class="wiki-link"><a href='/wiki/Advanced-Options.html'>Advanced Options</a></li>

  <li class="wiki-link"><a href='/wiki/Batches.html'>Batches</a></li>

  <li class="wiki-link"><a href='/wiki/Best-Practices.html'>Best Practices</a></li>

  <li class="wiki-link"><a href='/wiki/Build-vs-Buy.html'>Build vs Buy</a></li>

  <li class="wiki-link"><a href='/wiki/Bulk-Queueing.html'>Bulk Queueing</a></li>

  <li class="wiki-link"><a href='/wiki/Comm-Installation.html'>Comm Installation</a></li>

  <li class="wiki-link"><a href='/wiki/Commercial-FAQ.html'>Commercial FAQ</a></li>

  <li class="wiki-link"><a href='/wiki/Commercial-Support.html'>Commercial Support</a></li>

  <li class="wiki-link"><a href='/wiki/Commercial-collaboration.html'>Commercial collaboration</a></li>

  <li class="wiki-link"><a href='/wiki/Complex-Job-Workflows-with-Batches.html'>Complex Job Workflows with Batches</a></li>

  <li class="wiki-link"><a href='/wiki/Delayed-extensions.html'>Delayed extensions</a></li>

  <li class="wiki-link"><a href='/wiki/Deployment.html'>Deployment</a></li>

  <li class="wiki-link"><a href='/wiki/Devise.html'>Devise</a></li>

  <li class="wiki-link"><a href='/wiki/Embedding.html'>Embedding</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Encryption.html'>Ent Encryption</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Historical-Metrics.html'>Ent Historical Metrics</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Leader-Election.html'>Ent Leader Election</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Multi-Process.html'>Ent Multi Process</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Periodic-Jobs.html'>Ent Periodic Jobs</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Rate-Limiting.html'>Ent Rate Limiting</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Rolling-Restarts.html'>Ent Rolling Restarts</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Unique-Jobs.html'>Ent Unique Jobs</a></li>

  <li class="wiki-link"><a href='/wiki/Ent-Web-UI.html'>Ent Web UI</a></li>

  <li class="wiki-link"><a href='/wiki/Error-Handling.html'>Error Handling</a></li>

  <li class="wiki-link"><a href='/wiki/FAQ.html'>FAQ</a></li>

  <li class="wiki-link"><a href='/wiki/Getting-Started.html'>Getting Started</a></li>

  <li class="wiki-link"><a href='/wiki/Heroku.html'>Heroku</a></li>

  <li class="wiki-link"><a href='/wiki/Home.html'>Home</a></li>

  <li class="wiki-link"><a href='/wiki/Iteration.html'>Iteration</a></li>

  <li class="wiki-link"><a href='/wiki/Job-Format.html'>Job Format</a></li>

  <li class="wiki-link"><a href='/wiki/Job-Lifecycle.html'>Job Lifecycle</a></li>

  <li class="wiki-link"><a href='/wiki/Kubernetes.html'>Kubernetes</a></li>

  <li class="wiki-link"><a href='/wiki/Logging.html'>Logging</a></li>

  <li class="wiki-link"><a href='/wiki/Memory.html'>Memory</a></li>

  <li class="wiki-link"><a href='/wiki/Metrics.html'>Metrics</a></li>

  <li class="wiki-link"><a href='/wiki/Middleware.html'>Middleware</a></li>

  <li class="wiki-link"><a href='/wiki/Miscellaneous-Features.html'>Miscellaneous Features</a></li>

  <li class="wiki-link"><a href='/wiki/Monitoring.html'>Monitoring</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-API.html'>Pro API</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-Expiring-Jobs.html'>Pro Expiring Jobs</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-Metrics.html'>Pro Metrics</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-Reliability-Client.html'>Pro Reliability Client</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-Reliability-Server.html'>Pro Reliability Server</a></li>

  <li class="wiki-link"><a href='/wiki/Pro-Web-UI.html'>Pro Web UI</a></li>

  <li class="wiki-link"><a href='/wiki/Problems-and-Troubleshooting.html'>Problems and Troubleshooting</a></li>

  <li class="wiki-link"><a href='/wiki/Profiling.html'>Profiling</a></li>

  <li class="wiki-link"><a href='/wiki/Really-Complex-Workflows-with-Batches.html'>Really Complex Workflows with Batches</a></li>

  <li class="wiki-link"><a href='/wiki/Related-Projects.html'>Related Projects</a></li>

  <li class="wiki-link"><a href='/wiki/Reliability.html'>Reliability</a></li>

  <li class="wiki-link"><a href='/wiki/Scaling.html'>Scaling</a></li>

  <li class="wiki-link"><a href='/wiki/Scheduled-Jobs.html'>Scheduled Jobs</a></li>

  <li class="wiki-link"><a href='/wiki/Sharding.html'>Sharding</a></li>

  <li class="wiki-link"><a href='/wiki/Signals.html'>Signals</a></li>

  <li class="wiki-link"><a href='/wiki/Testimonials.html'>Testimonials</a></li>

  <li class="wiki-link"><a href='/wiki/Testing.html'>Testing</a></li>

  <li class="wiki-link"><a href='/wiki/The-Basics.html'>The Basics</a></li>

  <li class="wiki-link"><a href='/wiki/Using-Dragonfly.html'>Using Dragonfly</a></li>

  <li class="wiki-link"><a href='/wiki/Using-Redis.html'>Using Redis</a></li>

</ul></div>
    </div>
  </main>
</body>
</html>
